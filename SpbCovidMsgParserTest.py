import unittest
from SpbCovidMsgParser import SpbCovidMsgParser

class SpbCovidMsgParserTest(unittest.TestCase):

    def setUp(self):
        self.msg_aug10 = """–ö–ê–†–¢–ò–ù–ê –î–ù–Ø 10 –ê–í–ì–£–°–¢–ê
‚ûï –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ 157 –Ω–æ–≤—ã—Ö —Å–ª—É—á–∞–µ–≤ –∑–∞—Ä–∞–∂–µ–Ω–∏—è –∫–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å–Ω–æ–π –∏–Ω—Ñ–µ–∫—Ü–∏–µ–π.

üìâ –í—Å–µ–≥–æ —Å –Ω–∞—á–∞–ª–∞ –ø–∞–Ω–¥–µ–º–∏–∏ –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ 33204  —Å–ª—É—á–∞–µ–≤ –∑–∞—Ä–∞–∂–µ–Ω–∏—è COVID-19. 
–°–∫–æ–Ω—á–∞–ª–∏—Å—å 2176 —á–µ–ª–æ–≤–µ–∫. –í—ã–∑–¥–æ—Ä–æ–≤–µ–ª–æ 24165 —á–µ–ª–æ–≤–µ–∫.

üî¨ –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—É—Ç–∫–∏ –≤ –ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–ª–∏ –Ω–∞ –∫–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å 12050 —á–µ–ª–æ–≤–µ–∫.

üè† –ü–æ–¥ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è 713 —á–µ–ª–æ–≤–µ–∫. –ò–∑ –Ω–∏—Ö 150 - –≤ –æ–±—Å–µ—Ä–≤–∞—Ç–æ—Ä–µ, 299 - –Ω–∞ —Å–∞–º–æ–∏–∑–æ–ª—è—Ü–∏–∏, 264 - –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ."""

        self.msg_apr12 = """–ö–ê–†–¢–ò–ù–ê –î–ù–Ø 12 –ê–ü–†–ï–õ–Ø
‚ûï –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω 121 –Ω–æ–≤—ã–π —Å–ª—É—á–∞–π –∑–∞—Ä–∞–∂–µ–Ω–∏—è –∫–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å–Ω–æ–π –∏–Ω—Ñ–µ–∫—Ü–∏–µ–π.

‚ûñ –í—ã–∑–¥–æ—Ä–æ–≤–µ–ª–æ 4 —á–µ–ª–æ–≤–µ–∫–∞.

üìà –í—Å–µ–≥–æ —Å –Ω–∞—á–∞–ª–∞ –ø–∞–Ω–¥–µ–º–∏–∏ –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ 678 —Å–ª—É—á–∞–µ–≤ –∑–∞—Ä–∞–∂–µ–Ω–∏—è COVID-19. 
–£–º–µ—Ä–ª–æ 4 —á–µ–ª–æ–≤–µ–∫–∞. –í—ã–∑–¥–æ—Ä–æ–≤–µ–ª–æ 78 —á–µ–ª–æ–≤–µ–∫.
¬†
üî¨ –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—É—Ç–∫–∏ –≤ –ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–ª–∏ –Ω–∞ –∫–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å 1821 —á–µ–ª–æ–≤–µ–∫–∞. 

üè† –ù–∞ –∫–∞—Ä–∞–Ω—Ç–∏–Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è  5605 —á–µ–ª–æ–≤–µ–∫. –ò–∑ –Ω–∏—Ö 41 - –≤ –æ–±—Å–µ—Ä–≤–∞—Ç–æ—Ä–µ, 3128 - –Ω–∞ —Å–∞–º–æ–∏–∑–æ–ª—è—Ü–∏–∏, 2436 - –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ.
___

üìû –í —Å–ª—É–∂–±–µ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ 112 –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ 406 –æ–±—Ä–∞—â–µ–Ω–∏–π. –û –ø—Ä–∏–±—ã—Ç–∏–∏ –∏–∑ –¥—Ä—É–≥–æ–π —Å—Ç—Ä–∞–Ω—ã –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é –†–æ—Å—Å–∏–∏ —Å–æ–æ–±—â–∏–ª–∏ 76 —á–µ–ª–æ–≤–µ–∫. –í –ì–æ—Ä–æ–¥—Å–∫—É—é —Å–ª—É–∂–±—É —Å–∫–æ—Ä–æ–π –ø–æ–º–æ—â–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–æ 111 –æ–±—Ä–∞—â–µ–Ω–∏–π, –≤ –ø–æ–ª–∏—Ü–∏—é - 108. –û—Å—Ç–∞–ª—å–Ω—ã–µ –∑–≤–æ–Ω–∫–∏ –±—ã–ª–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–æ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞.
"""

        self.msg_apr22 = """–ö–ê–†–¢–ò–ù–ê –î–ù–Ø 22 –ê–ü–†–ï–õ–Ø 
¬†
‚ûï –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω 191 –Ω–æ–≤—ã–π —Å–ª—É—á–∞–π –∑–∞—Ä–∞–∂–µ–Ω–∏—è –∫–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å–Ω–æ–π –∏–Ω—Ñ–µ–∫—Ü–∏–µ–π.

üìà –í—Å–µ–≥–æ —Å –Ω–∞—á–∞–ª–∞ –ø–∞–Ω–¥–µ–º–∏–∏ –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ  2458 —Å–ª—É—á–∞–µ–≤ –∑–∞—Ä–∞–∂–µ–Ω–∏—è COVID-19. 
–£–º–µ—Ä–ª–æ 17 —á–µ–ª–æ–≤–µ–∫. –í—ã–∑–¥–æ—Ä–æ–≤–µ–ª–æ 368 —á–µ–ª–æ–≤–µ–∫.

üî¨ –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—É—Ç–∫–∏ –≤ –ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–æ –Ω–∞ –∫–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å ¬†8196 —á–µ–ª–æ–≤–µ–∫. 

üè† –ù–∞ –∫–∞—Ä–∞–Ω—Ç–∏–Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è  2974 —á–µ–ª–æ–≤–µ–∫–∞. –ò–∑ –Ω–∏—Ö 63 - –≤ –æ–±—Å–µ—Ä–≤–∞—Ç–æ—Ä–µ, 545 - –Ω–∞ —Å–∞–º–æ–∏–∑–æ–ª—è—Ü–∏–∏, 2366 - –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ.
___

üöë –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ 1567 –≤—ã–∑–æ–≤–æ–≤, –ø–æ—Å—Ç—É–ø–∏–≤—à–∏—Ö –Ω–∞ –Ω–æ–º–µ—Ä 122 –≤ –ï–¥–∏–Ω—É—é —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ-—Å–ø—Ä–∞–≤–æ—á–Ω—É—é —Å–ª—É–∂–±—É –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º,—Å–≤—è–∑–∞–Ω–Ω—ã–º —Å –∫–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å–æ–º.

üìû –í —Å–ª—É–∂–±–µ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ 112 –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ 702 –æ–±—Ä–∞—â–µ–Ω–∏—è. –û –ø—Ä–∏–±—ã—Ç–∏–∏ –∏–∑ –¥—Ä—É–≥–æ–π —Å—Ç—Ä–∞–Ω—ã –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é –†–æ—Å—Å–∏–∏ —Å–æ–æ–±—â–∏–ª–∏ 13 —á–µ–ª–æ–≤–µ–∫. –í –ì–æ—Ä–æ–¥—Å–∫—É—é —Å–ª—É–∂–±—É —Å–∫–æ—Ä–æ–π –ø–æ–º–æ—â–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–æ 55 –æ–±—Ä–∞—â–µ–Ω–∏–π, –≤ –ø–æ–ª–∏—Ü–∏—é - 149. –û—Å—Ç–∞–ª—å–Ω—ã–µ –∑–≤–æ–Ω–∫–∏ –±—ã–ª–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–æ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞."""

        self.msg_nov8 = """–ö–∞—Ä—Ç–∏–Ω–∞ –¥–Ω—è 8 –Ω–æ—è–±—Ä—è
 
‚ûï –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ 1403 –Ω–æ–≤—ã—Ö —Å–ª—É—á–∞—è –∑–∞—Ä–∞–∂–µ–Ω–∏—è –∫–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å–Ω–æ–π –∏–Ω—Ñ–µ–∫—Ü–∏–µ–π.

üìâ –í—Å–µ–≥–æ —Å –Ω–∞—á–∞–ª–∞ –ø–∞–Ω–¥–µ–º–∏–∏ –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ 71426 —Å–ª—É—á–∞–µ–≤ –∑–∞—Ä–∞–∂–µ–Ω–∏—è COVID-19. 
–°–∫–æ–Ω—á–∞–ª–∏—Å—å 4181—á–µ–ª–æ–≤–µ–∫. –í—ã–∑–¥–æ—Ä–æ–≤–µ–ª–æ 43501 —á–µ–ª–æ–≤–µ–∫.

üî¨ –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—É—Ç–∫–∏ –≤ –ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–ª–∏ –Ω–∞ –∫–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å 25651—á–µ–ª–æ–≤–µ–∫–∞.

üè† –ü–æ–¥ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è 4039 —á–µ–ª–æ–≤–µ–∫. –ò–∑ –Ω–∏—Ö 83 - –≤ –æ–±—Å–µ—Ä–≤–∞—Ç–æ—Ä–µ, 1405 - –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ, 2551 - –Ω–∞ —Å–∞–º–æ–∏–∑–æ–ª—è—Ü–∏–∏."""

        self.msg_apr6 = """–ö–ê–†–¢–ò–ù–ê –î–ù–Ø 6 –ê–ü–†–ï–õ–Ø
 
‚ûï –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ 69 –Ω–æ–≤—ã—Ö —Å–ª—É—á–∞–µ–≤ –∑–∞—Ä–∞–∂–µ–Ω–∏—è –∫–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å–Ω–æ–π –∏–Ω—Ñ–µ–∫—Ü–∏–µ–π.

üìà –í—Å–µ–≥–æ —Å –Ω–∞—á–∞–ª–∞ –ø–∞–Ω–¥–µ–º–∏–∏ –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ 295 —Å–ª—É—á–∞–µ–≤ –∑–∞—Ä–∞–∂–µ–Ω–∏—è COVID-19. –í—ã–∑–¥–æ—Ä–æ–≤–µ–ª–æ 36 —á–µ–ª–æ–≤–µ–∫. –£–º–µ—Ä–ª–æ 3* —á–µ–ª–æ–≤–µ–∫–∞.

–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—É—Ç–∫–∏ –≤ –ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–æ –Ω–∞ –∫–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å 6957 —á–µ–ª–æ–≤–µ–∫.

üè† –ù–∞ –∫–∞—Ä–∞–Ω—Ç–∏–Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è 8917 —á–µ–ª–æ–≤–µ–∫. –ò–∑ –Ω–∏—Ö 35 - –≤ –æ–±—Å–µ—Ä–≤–∞—Ç–æ—Ä–µ, 7987 - –Ω–∞ —Å–∞–º–æ–∏–∑–æ–ª—è—Ü–∏–∏. 
___

üìû –í —Å–ª—É–∂–±–µ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ 112 –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ 1356 –æ–±—Ä–∞—â–µ–Ω–∏–π. –û –ø—Ä–∏–±—ã—Ç–∏–∏ –∏–∑ –¥—Ä—É–≥–æ–π —Å—Ç—Ä–∞–Ω—ã –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—é –†–æ—Å—Å–∏–∏ —Å–æ–æ–±—â–∏–ª 71 —á–µ–ª–æ–≤–µ–∫. –í –ì–æ—Ä–æ–¥—Å–∫—É—é —Å–ª—É–∂–±—É —Å–∫–æ—Ä–æ–π –ø–æ–º–æ—â–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–æ 125 –æ–±—Ä–∞—â–µ–Ω–∏–π, –≤ –ø–æ–ª–∏—Ü–∏—é - 123. –û—Å—Ç–∞–ª—å–Ω—ã–µ –∑–≤–æ–Ω–∫–∏ –±—ã–ª–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–æ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞.

* - –ø–æ –æ–¥–Ω–æ–π –∏–∑ —Å–º–µ—Ä—Ç–µ–π –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞."""


        self.msg_dec15 = """–ö–∞—Ä—Ç–∏–Ω–∞ –¥–Ω—è 15 –¥–µ–∫–∞–±—Ä—è
 
‚ûï –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ 3758 –Ω–æ–≤—ã—Ö —Å–ª—É—á–∞–µ–≤ –∑–∞—Ä–∞–∂–µ–Ω–∏—è –∫–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å–Ω–æ–π –∏–Ω—Ñ–µ–∫—Ü–∏–µ–π.

üìâ –í—Å–µ–≥–æ —Å –Ω–∞—á–∞–ª–∞ –ø–∞–Ω–¥–µ–º–∏–∏ –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ  185780 —Å–ª—É—á–∞–µ–≤ –∑–∞—Ä–∞–∂–µ–Ω–∏—è COVID-19. 
–°–∫–æ–Ω—á–∞–ª–∏—Å—å 6529 —á–µ–ª–æ–≤–µ–∫. –í—ã–∑–¥–æ—Ä–æ–≤–µ–ª–æ 105665 —á–µ–ª–æ–≤–µ–∫.

üî¨ –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—É—Ç–∫–∏ –≤ –ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–ª–∏ –Ω–∞ –∫–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å 35 593 —á–µ–ª–æ–≤–µ–∫–∞.

üè† –ü–æ–¥ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è 1782 —á–µ–ª–æ–≤–µ–∫–∞. –ò–∑ –Ω–∏—Ö 15 - –≤ –æ–±—Å–µ—Ä–≤–∞—Ç–æ—Ä–µ, 1274 - –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ, 493 - –Ω–∞ —Å–∞–º–æ–∏–∑–æ–ª—è—Ü–∏–∏."""

    def test_apr6_cases(self):
        p = SpbCovidMsgParser()
        result = p.parse_cases(self.msg_apr6)
        self.assertEqual("6 –ê–ü–†–ï–õ–Ø", result["date"])
        self.assertEqual("69", result["new_cases"])
        self.assertEqual("295", result["total_cases"])

    def test_apr6_tested(self):
        p = SpbCovidMsgParser()
        result = p.parse_tested(self.msg_apr6)
        self.assertEqual("6957", result["tested"])

    def test_apr6_cured_died(self):
        p = SpbCovidMsgParser()
        result = p.parse_cured_died(self.msg_apr6)
        self.assertEqual("36", result["cured"])
        self.assertEqual("3", result["died"])

    def test_nov11_cases(self):
        p = SpbCovidMsgParser()
        result = p.parse_cases(self.msg_nov8)

        self.assertEqual("1403", result["new_cases"])

    def test_nov8_cases(self):
        p = SpbCovidMsgParser()
        result = p.parse_cases(self.msg_nov8)

        self.assertEqual("8 –Ω–æ—è–±—Ä—è", result["date"])
        self.assertEqual("1403", result["new_cases"])
        self.assertEqual("71426", result["total_cases"])

    def test_nov8_tested(self):
        p = SpbCovidMsgParser()
        result = p.parse_tested(self.msg_nov8)
        self.assertEqual("25651", result["tested"])


    def test_nov8_cured_died(self):
        p = SpbCovidMsgParser()
        result = p.parse_cured_died(self.msg_nov8)
        self.assertEqual("43501", result["cured"])
        self.assertEqual("4181", result["died"])

    def test_aug10_cases(self):
        p = SpbCovidMsgParser()
        result = p.parse_cases(self.msg_aug10)

        self.assertEqual("157", result["new_cases"])


    def test_apr12_cases(self):
        p = SpbCovidMsgParser()
        result = p.parse_cases(self.msg_apr12)
        self.assertEqual("12 –ê–ü–†–ï–õ–Ø", result["date"])
        self.assertEqual("121", result["new_cases"])
        self.assertEqual("678", result["total_cases"])

    def test_apr12_cured_died(self):
        p = SpbCovidMsgParser()
        result = p.parse_cured_died(self.msg_apr12)
        self.assertEqual("78", result["cured"])
        self.assertEqual("4", result["died"])

    def test_apr22_cases(self):
        p = SpbCovidMsgParser()
        result = p.parse_cases(self.msg_apr22)
        self.assertEqual("22 –ê–ü–†–ï–õ–Ø", result["date"])
        self.assertEqual("191", result["new_cases"])
        self.assertEqual("2458", result["total_cases"])

    def test_apr22_cured_died(self):
        p = SpbCovidMsgParser()
        result = p.parse_cured_died(self.msg_apr22)
        self.assertEqual("368", result["cured"])
        self.assertEqual("17", result["died"])

    def test_apr22_tested(self):
        p = SpbCovidMsgParser()
        result = p.parse_tested(self.msg_apr22)
        self.assertEqual("8196", result["tested"])

    def test_apr12_parse(self):
        p = SpbCovidMsgParser()
        result = p.parse(self.msg_apr12)
        self.assertEqual("12 –ê–ü–†–ï–õ–Ø", result["date"])
        self.assertEqual("121", result["new_cases"])
        self.assertEqual("678", result["total_cases"])
        self.assertEqual("78", result["cured"])
        self.assertEqual("4", result["died"])


    def test_dec15_parse(self):
        p = SpbCovidMsgParser()
        result = p.parse(self.msg_dec15)
        self.assertEqual("15 –¥–µ–∫–∞–±—Ä—è", result["date"])
        self.assertEqual("3758", result["new_cases"])
        self.assertEqual("185780", result["total_cases"])
        self.assertEqual("6529", result["died"])
        self.assertEqual("105665", result["cured"])
        self.assertEqual("35593", result["tested"])

    def test_regex_replace(self):
        def space_repl(match):
            return match.group().replace(" ", "")

        import re
        str = re.sub(r"\d+( )\d+", space_repl, "aaa 444 33 sss")
        self.assertEqual("aaa 44433 sss", str)

if __name__ == '__main__':
    unittest.main()
